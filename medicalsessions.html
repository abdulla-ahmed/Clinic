<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Medical Session - Al-Kawaz Clinic</title>
  <script src="https://unpkg.com/html5-qrcode"></script>
  <style>
    :root { --primary: #6698fd; --dark: #2c3e50; --border: #e0e0e0; }
    body { font-family: "Times New Roman", Times, serif; background: #fdfdfd; margin: 20px; color: var(--dark); }
    .container { max-width: 850px; margin: auto; background: white; padding: 30px; border: 1px solid var(--border); border-radius: 8px; }
    
    /* Search Section */
    .search-section { background: #eef4ff; padding: 15px; border-radius: 12px; margin-bottom: 20px; border: 1px solid var(--primary); }
    h3 { text-align: center; margin-top: 0; }
    input, textarea { width: 100%; padding: 10px; margin: 8px 0; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; font-size: 1em; }
    .search-date-label { display: block; margin-top: 10px; font-weight: bold; color: var(--dark); font-size: 0.9em; }

    /* Patient Info Section - Small Font Only Here */
    .patient-profile-column { display: flex; flex-direction: column; align-items: center; padding: 15px; background: #f0f4ff; border-radius: 12px; margin-bottom: 30px; border: 1px solid #ddecff; }
    .patient-photo { width: 130px; height: 150px; object-fit: cover; border: 3px solid white; border-radius: 8px; margin-bottom: 15px; }
    .info-list { width: 100%; max-width: 650px; font-size: 0.82em; } /* Smaller font for info only */
    .info-row { display: flex; justify-content: space-between; padding: 3px 0; border-bottom: 1px solid rgba(102, 152, 253, 0.15); width: 100%; }
    .info-label { font-weight: bold; color: #555; }
    .info-value { color: #000; text-align: right; }

    /* Vitals Styling - Units outside, clean boxes */
    .vitals-grid { display: flex; flex-wrap: wrap; gap: 25px; align-items: center; }
    .vital-item { display: flex; align-items: center; gap: 8px; }
    .vital-item label { font-weight: bold; width: 45px; }
    .vital-input-wrapper { display: flex; align-items: center; gap: 5px; }
    .v-box { width: 60px; height: 35px; border: 1px solid #ccc; border-radius: 6px; text-align: center; font-weight: normal; font-size: 1em; }
    .unit-label { font-size: 0.9em; color: #666; font-weight: normal; }

    /* BP Specific Styling */
    .bp-box { width: 50px; } /* Slightly wider for BP numbers */
    .slash { font-size: 1.2em; color: #999; }

    /* Layout Boxes */
    .group-box { padding: 20px; border-radius: 12px; margin-bottom: 25px; border: 1px solid rgba(0,0,0,0.05); }
    .history-box { background-color: #fef9e7; border-left: 6px solid #f1c40f; }
    .vitals-box { background-color: #e8f8f5; border-left: 6px solid #1abc9c; }
    .exam-box { background-color: #f4f4f9; border-left: 6px solid #5d6d7e; }
    .section-title { font-size: 1.1em; font-weight: bold; margin-bottom: 15px; text-transform: uppercase; }

    /* Buttons */
    button { display: block; width: 100%; max-width: 450px; margin: 10px auto; padding: 12px; border-radius: 8px; border: none; cursor: pointer; font-weight: bold; color: white; }
    .btn-search { background-color: var(--primary); }
    .footer-btns { display: flex; gap: 15px; margin-top: 30px; }
    
    #session-form { display: none; }
  </style>
</head>
<body>

<div class="container">
  <h1 style="text-align:center;">Medical Session</h1>

  <div class="search-section" id="search-block">
    <h3>Find Patient</h3>
    <input type="text" id="searchInput" placeholder="Search Name, Reg. No., or Barcode">
    <label class="search-date-label">Search by Date:</label>
    <input type="date" id="searchDate">
    <button type="button" class="btn-search" onclick="searchPatient()">Search Patient</button>
    <div id="resultsArea" style="display:none; margin-top:15px;">
        <table style="width:100%; border-collapse: collapse; font-size:0.9em;">
            <tbody id="resultsBody"></tbody>
        </table>
    </div>
  </div>

  <div id="session-form">
    <h2 id="visitDisplay" style="text-align:center; color: var(--primary);"></h2>

    <div class="patient-profile-column">
      <img id="p_photo" class="patient-photo" src="" alt="No Image">
      <div class="info-list" id="p_info_details"></div>
    </div>

    <div class="group-box vitals-box">
      <div class="section-title">Vital Signs</div>
      <div class="vitals-grid">
        <div class="vital-item">
            <label>Temp</label>
            <div class="vital-input-wrapper">
                <input type="number" id="v_temp" class="v-box"> <span class="unit-label">CÂ°</span>
            </div>
        </div>
        <div class="vital-item">
            <label>HR</label>
            <div class="vital-input-wrapper">
                <input type="number" id="v_hr" class="v-box"> <span class="unit-label">bpm</span>
            </div>
        </div>
        <div class="vital-item">
            <label>RR</label>
            <div class="vital-input-wrapper">
                <input type="number" id="v_rr" class="v-box"> <span class="unit-label">bpm</span>
            </div>
        </div>
        <div class="vital-item">
            <label>BP</label>
            <div class="vital-input-wrapper">
                <input type="number" id="v_bp_s" class="v-box bp-box" placeholder="Sys"> 
                <span class="slash">/</span> 
                <input type="number" id="v_bp_d" class="v-box bp-box" placeholder="Dia">
                <span class="unit-label">mmHg</span>
            </div>
        </div>
      </div>
    </div>

    <div class="group-box history-box">
      <div class="section-title">Clinical History</div>
      <label>Chief Complain</label><textarea id="h_chief" rows="2"></textarea>
      <label>Present Illness</label><textarea id="h_illness" rows="6"></textarea>
      <label>Review of Systems</label><textarea id="h_ros" rows="4"></textarea>
    </div>

    <div class="footer-btns">
      <button style="background: var(--dark);" onclick="alert('Saving...')">Save Session</button>
      <button style="background: #95a5a6;" onclick="location.reload()">Cancel</button>
    </div>
  </div>
</div>

<script>
  let allPatients = JSON.parse(localStorage.getItem('patients')) || [];

  function searchPatient() {
    const textQuery = document.getElementById('searchInput').value.toLowerCase().trim();
    const resultsBody = document.getElementById('resultsBody');
    resultsBody.innerHTML = ""; 

    const matches = allPatients.filter(p => p.name.toLowerCase().includes(textQuery) || p.regNumber.includes(textQuery));

    if (matches.length > 0) {
      document.getElementById('resultsArea').style.display = "block";
      matches.forEach(p => {
        resultsBody.innerHTML += `<tr style="border-bottom:1px solid #eee; cursor:pointer;" onclick='loadForm(${JSON.stringify(p)})'>
            <td style="padding:10px;">${p.name}</td><td>${p.regNumber}</td></tr>`;
      });
    } else { alert("Not found."); }
  }

  function loadForm(p) {
    document.getElementById('search-block').style.display = 'none';
    document.getElementById('session-form').style.display = 'block';
    document.getElementById('p_photo').src = p.photo || '';
    
    const infoContainer = document.getElementById('p_info_details');
    // Using your requested Abbreviations
    const fields = [
      { label: "Name:", val: p.name },
      { label: "Reg. No.:", val: p.regNumber },
      { label: "Age:", val: p.age },
      { label: "Sex:", val: p.sex },
      { label: "Race:", val: p.race },
      { label: "Religion:", val: p.religion },
      { label: "Bl. gr. & Rh:", val: p.bloodGroup },
      { label: "Occupation:", val: p.occupation },
      { label: "Address:", val: p.address },
      { label: "Next of Kin:", val: p.nextOfKin },
      { label: "Kin Add.:", val: p.kinAddress },
      { label: "Kin Phone:", val: p.kinPhone }
    ];

    infoContainer.innerHTML = fields.map(f => f.val ? 
      `<div class="info-row"><span class="info-label">${f.label}</span><span class="info-value">${f.val}</span></div>` : ''
    ).join('');
  }
</script>
</body>
</html>
